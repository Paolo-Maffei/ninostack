<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>nanoStack: /home/juha/ns_1_1_0/subversion/nanostack/Common/modules/mac_15_4.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_0525437242290fbe482ba568e20723dc.html">Common</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_585dc3ac68ae268e229f28482e3adce5.html">modules</a></div>
<h1>mac_15_4.c File Reference</h1>802.15.4 protocol module. <a href="#_details">More...</a>
<p>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &quot;FreeRTOS.h&quot;</code><br>
<code>#include &quot;task.h&quot;</code><br>
<code>#include &quot;queue.h&quot;</code><br>
<code>#include &quot;semphr.h&quot;</code><br>
<code>#include &quot;list.h&quot;</code><br>
<code>#include &quot;<a class="el" href="debug_8h.html">debug.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="socket_8h.html">socket.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="buffer_8h.html">buffer.h</a>&quot;</code><br>
<code>#include &quot;bus.h&quot;</code><br>
<code>#include &quot;<a class="el" href="module_8h.html">module.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="control__message_8h.html">control_message.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="cipv6_8h.html">cipv6.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="rf_8h.html">rf.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="mac_8h.html">mac.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="gpio_8h.html">gpio.h</a>&quot;</code><br>
<code>#include &quot;aes.h&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#e21043003731fcc05157f61cb6351a70">FC_DST_MODE</a>&nbsp;&nbsp;&nbsp;0x0C00</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#5ab9bd89f5668ce9096c7f90e2e7d6df">mac_task</a> (void *pvParameters)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#50c63df28d5eb2857387653e60c787c4">push_bl_event</a> (<a class="el" href="structbuffer__t.html">buffer_t</a> *b)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#9d7b1129612d8ca2198198ae50bd97ab">push_ttl_update_event</a> (<a class="el" href="structbuffer__t.html">buffer_t</a> *b)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#e7ce2581092a30f23ebd8018f6fe7a8c">mac_data_up</a> (<a class="el" href="structbuffer__t.html">buffer_t</a> *buf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">mac_tx_status_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#90f421f8a9616c7271345fc9d43a5bf0">mac_buffer_out</a> (<a class="el" href="structbuffer__t.html">buffer_t</a> *buf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#10fb5a7d3cd3ea7b7e5fa11098096e54">mac_adhoc</a> (mac_event_t event, <a class="el" href="structbuffer__t.html">buffer_t</a> *buf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#075560080dee25cd872bfd7f6019cc4c">mac_scan</a> (mac_event_t curr_event, <a class="el" href="structbuffer__t.html">buffer_t</a> *buf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#26123fe135eee072c63b8548f8ca402e">mac_header_generate</a> (<a class="el" href="structbuffer__t.html">buffer_t</a> *buf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#68176a1564f843a231850b1f23bec8a8">mac_timer_callback</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#b2528ef2a5447d1130407d221baf9f80">mac_start_ed_scan</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#3a1aa8cd4d2b015130da2b84c52ec85f">mac_gw_discover</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#9cd03f8f49180c7412f93beae31ae84c">ack_handle</a> (uint8_t sqn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mac__15__4_8c.html#758ebd59146e7c5d54243b4089cf0b51">rf_802_15_4_ip_layer_address_mode_set</a> (uint8_t support_short_addr)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
802.15.4 protocol module. 
<p>
802.15.4 MAC and CSMA sequence: handler functions. Modular version for positioning support etc. <hr><h2>Define Documentation</h2>
<a class="anchor" name="e21043003731fcc05157f61cb6351a70"></a><!-- doxytag: member="mac_15_4.c::FC_DST_MODE" ref="e21043003731fcc05157f61cb6351a70" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FC_DST_MODE&nbsp;&nbsp;&nbsp;0x0C00          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
MAC Header masks 
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="9cd03f8f49180c7412f93beae31ae84c"></a><!-- doxytag: member="mac_15_4.c::ack_handle" ref="9cd03f8f49180c7412f93beae31ae84c" args="(uint8_t sqn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ack_handle           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>sqn</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
RF RX interrupt ACK handle.<p>
Function check ACK status in the MAC.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sqn</em>&nbsp;</td><td>ack sequency number </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="10fb5a7d3cd3ea7b7e5fa11098096e54"></a><!-- doxytag: member="mac_15_4.c::mac_adhoc" ref="10fb5a7d3cd3ea7b7e5fa11098096e54" args="(mac_event_t event, buffer_t *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mac_adhoc           </td>
          <td>(</td>
          <td class="paramtype">mac_event_t&nbsp;</td>
          <td class="paramname"> <em>curr_event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structbuffer__t.html">buffer_t</a> *&nbsp;</td>
          <td class="paramname"> <em>buf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
MAC ad-hoc mode packet handle. 
</div>
</div><p>
<a class="anchor" name="90f421f8a9616c7271345fc9d43a5bf0"></a><!-- doxytag: member="mac_15_4.c::mac_buffer_out" ref="90f421f8a9616c7271345fc9d43a5bf0" args="(buffer_t *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mac_tx_status_t mac_buffer_out           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbuffer__t.html">buffer_t</a> *&nbsp;</td>
          <td class="paramname"> <em>buf</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Buffer send API for MAC module.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>indicates pointer for buffer structure.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>MAC_TX_OK_ACK, TX ok waiting ACK <p>
MAC_TX_OK TX complete <p>
MAC_TX_BUSY, channel busy <p>
MAC_TX_CCA, channel not free </dd></dl>

</div>
</div><p>
<a class="anchor" name="e7ce2581092a30f23ebd8018f6fe7a8c"></a><!-- doxytag: member="mac_15_4.c::mac_data_up" ref="e7ce2581092a30f23ebd8018f6fe7a8c" args="(buffer_t *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mac_data_up           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbuffer__t.html">buffer_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Push Data buffer to upper layer from MAC.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>indicates pointer for buffer structure. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="3a1aa8cd4d2b015130da2b84c52ec85f"></a><!-- doxytag: member="mac_15_4.c::mac_gw_discover" ref="3a1aa8cd4d2b015130da2b84c52ec85f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mac_gw_discover           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
GW scan with channel change.<p>
Change next channel and create &amp; send ROUTER SOLICATION MESSAGE 
</div>
</div><p>
<a class="anchor" name="26123fe135eee072c63b8548f8ca402e"></a><!-- doxytag: member="mac_15_4.c::mac_header_generate" ref="26123fe135eee072c63b8548f8ca402e" args="(buffer_t *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t mac_header_generate           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbuffer__t.html">buffer_t</a> *&nbsp;</td>
          <td class="paramname"> <em>buf</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Function creates MAC-frame.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>indicates pointer for buffer structure. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>ack flag which indicated ack-requirement for frame. </dd></dl>

</div>
</div><p>
<a class="anchor" name="075560080dee25cd872bfd7f6019cc4c"></a><!-- doxytag: member="mac_15_4.c::mac_scan" ref="075560080dee25cd872bfd7f6019cc4c" args="(mac_event_t curr_event, buffer_t *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mac_scan           </td>
          <td>(</td>
          <td class="paramtype">mac_event_t&nbsp;</td>
          <td class="paramname"> <em>curr_event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structbuffer__t.html">buffer_t</a> *&nbsp;</td>
          <td class="paramname"> <em>buf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
MAC scan mode function.<p>
When MAC_ENERGY_SCAN is defined (GW device) this function analyze all 16 channel Energy level and select first free channel. 
</div>
</div><p>
<a class="anchor" name="b2528ef2a5447d1130407d221baf9f80"></a><!-- doxytag: member="mac_15_4.c::mac_start_ed_scan" ref="b2528ef2a5447d1130407d221baf9f80" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mac_start_ed_scan           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Enable ED-scan.<p>
Working only when MAC_ENERGY_SCAN defined 
</div>
</div><p>
<a class="anchor" name="5ab9bd89f5668ce9096c7f90e2e7d6df"></a><!-- doxytag: member="mac_15_4.c::mac_task" ref="5ab9bd89f5668ce9096c7f90e2e7d6df" args="(void *pvParameters)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mac_task           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>pvParameters</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Mac task.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pvParameters</em>&nbsp;</td><td>not used </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="68176a1564f843a231850b1f23bec8a8"></a><!-- doxytag: member="mac_15_4.c::mac_timer_callback" ref="68176a1564f843a231850b1f23bec8a8" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mac_timer_callback           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
MAC timer Callback.<p>
CB send MAC timer event to MAC 
</div>
</div><p>
<a class="anchor" name="50c63df28d5eb2857387653e60c787c4"></a><!-- doxytag: member="mac_15_4.c::push_bl_event" ref="50c63df28d5eb2857387653e60c787c4" args="(buffer_t *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void push_bl_event           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbuffer__t.html">buffer_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Push Broken Link event to cIPV module.<p>
When ACK not received after 4 re-tx.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>indicates pointer for buffer structure. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="9d7b1129612d8ca2198198ae50bd97ab"></a><!-- doxytag: member="mac_15_4.c::push_ttl_update_event" ref="9d7b1129612d8ca2198198ae50bd97ab" args="(buffer_t *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void push_ttl_update_event           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbuffer__t.html">buffer_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Push Neighbour &amp; Routing table TTL update event to cIPV module.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>indicates pointer for buffer structure. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="758ebd59146e7c5d54243b4089cf0b51"></a><!-- doxytag: member="mac_15_4.c::rf_802_15_4_ip_layer_address_mode_set" ref="758ebd59146e7c5d54243b4089cf0b51" args="(uint8_t support_short_addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rf_802_15_4_ip_layer_address_mode_set           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>support_short_addr</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Function setup IP modules address mode and also forward MAC and short address information.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>support_short_addr</em>&nbsp;</td><td>1=Support &amp; 0=Not support. </td></tr>
  </table>
</dl>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Wed Jun 18 15:50:12 2008 for nanoStack by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
